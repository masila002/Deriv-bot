<?xml version="1.0" encoding="UTF-8"?>
<xml xmlns="https://developers.google.com/blockly/xml">

  <variables>
    <variable id="tick_count">tick_count</variable>
    <variable id="found_4_or_5">found_4_or_5</variable>
    <variable id="last_digit">last_digit</variable>
  </variables>

  <block type="trade" x="40" y="40">
    <statement name="SUBMARKET">
      <block type="submarket">
        <field name="SUBMARKET">synthetic_index</field>
        <statement name="MARKET">
          <block type="market">
            <field name="MARKET">random_index</field>
            <statement name="SYMBOL">
              <block type="symbol">
                <field name="SYMBOL">R_10</field>

                <next>
                  <block type="variables_set">
                    <field name="VAR" id="tick_count">tick_count</field>
                    <value name="VALUE">
                      <block type="math_number">
                        <field name="NUM">0</field>
                      </block>
                    </value>

                    <next>
                      <block type="variables_set">
                        <field name="VAR" id="found_4_or_5">found_4_or_5</field>
                        <value name="VALUE">
                          <block type="logic_boolean">
                            <field name="BOOL">FALSE</field>
                          </block>
                        </value>

                        <next>
                          <block type="on_tick">
                            <statement name="TICK">

                              <!-- last digit -->
                              <block type="variables_set">
                                <field name="VAR" id="last_digit">last_digit</field>
                                <value name="VALUE">
                                  <block type="math_last_digit">
                                    <value name="NUM">
                                      <block type="tick_quote"/>
                                    </value>
                                  </block>
                                </value>

                                <!-- tick_count + 1 -->
                                <next>
                                  <block type="variables_set">
                                    <field name="VAR" id="tick_count">tick_count</field>
                                    <value name="VALUE">
                                      <block type="math_arithmetic">
                                        <field name="OP">ADD</field>
                                        <value name="A">
                                          <block type="variables_get">
                                            <field name="VAR" id="tick_count">tick_count</field>
                                          </block>
                                        </value>
                                        <value name="B">
                                          <block type="math_number">
                                            <field name="NUM">1</field>
                                          </block>
                                        </value>
                                      </block>
                                    </value>

                                    <!-- check 4 or 5 -->
                                    <next>
                                      <block type="controls_if">
                                        <value name="IF0">
                                          <block type="logic_or">
                                            <value name="A">
                                              <block type="logic_compare">
                                                <field name="OP">EQ</field>
                                                <value name="A">
                                                  <block type="variables_get">
                                                    <field name="VAR" id="last_digit">last_digit</field>
                                                  </block>
                                                </value>
                                                <value name="B">
                                                  <block type="math_number">
                                                    <field name="NUM">4</field>
                                                  </block>
                                                </value>
                                              </block>
                                            </value>
                                            <value name="B">
                                              <block type="logic_compare">
                                                <field name="OP">EQ</field>
                                                <value name="A">
                                                  <block type="variables_get">
                                                    <field name="VAR" id="last_digit">last_digit</field>
                                                  </block>
                                                </value>
                                                <value name="B">
                                                  <block type="math_number">
                                                    <field name="NUM">5</field>
                                                  </block>
                                                </value>
                                              </block>
                                            </value>
                                          </block>
                                        </value>

                                        <statement name="DO0">
                                          <block type="variables_set">
                                            <field name="VAR" id="found_4_or_5">found_4_or_5</field>
                                            <value name="VALUE">
                                              <block type="logic_boolean">
                                                <field name="BOOL">TRUE</field>
                                              </block>
                                            </value>
                                          </block>
                                        </statement>

                                        <!-- when tick_count = 10 -->
                                        <next>
                                          <block type="controls_if">
                                            <value name="IF0">
                                              <block type="logic_compare">
                                                <field name="OP">EQ</field>
                                                <value name="A">
                                                  <block type="variables_get">
                                                    <field name="VAR" id="tick_count">tick_count</field>
                                                  </block>
                                                </value>
                                                <value name="B">
                                                  <block type="math_number">
                                                    <field name="NUM">10</field>
                                                  </block>
                                                </value>
                                              </block>
                                            </value>

                                            <statement name="DO0">
                                              <block type="controls_if">
                                                <value name="IF0">
                                                  <block type="logic_negate">
                                                    <value name="BOOL">
                                                      <block type="variables_get">
                                                        <field name="VAR" id="found_4_or_5">found_4_or_5</field>
                                                      </block>
                                                    </value>
                                                  </block>
                                                </value>

                                                <statement name="DO0">
                                                  <block type="trade_definition">
                                                    <field name="CONTRACT_TYPE">DIGITOVER</field>
                                                    <field name="BARRIER">4</field>
                                                    <field name="DURATION">1</field>
                                                    <field name="DURATION_UNIT">t</field>
                                                    <field name="AMOUNT">1</field>
                                                    <field name="CURRENCY">USD</field>
                                                  </block>
                                                </statement>

                                                <next>
                                                  <block type="variables_set">
                                                    <field name="VAR" id="tick_count">tick_count</field>
                                                    <value name="VALUE">
                                                      <block type="math_number">
                                                        <field name="NUM">0</field>
                                                      </block>
                                                    </value>
                                                    <next>
                                                      <block type="variables_set">
                                                        <field name="VAR" id="found_4_or_5">found_4_or_5</field>
                                                        <value name="VALUE">
                                                          <block type="logic_boolean">
                                                            <field name="BOOL">FALSE</field>
                                                          </block>
                                                        </value>
                                                      </block>
                                                    </next>
                                                  </block>
                                                </next>

                                              </block>
                                            </statement>
                                          </block>
                                        </next>

                                      </block>
                                    </next>

                                  </block>
                                </next>

                              </block>

                            </statement>
                          </block>
                        </next>

                      </block>
                    </next>

                  </block>
                </next>

              </block>
            </statement>
          </block>
        </statement>
      </block>
    </statement>
  </block>

</xml>
